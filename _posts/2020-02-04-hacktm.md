---
layout : post
title : Hacktm CTF 2020    
---   


# HackTm 2019    
  - 4 solved :     
     👉 RSA1    
     👉 RSA2    
     👉 Prision break    
     👉 [**Baby bear**](#wu1)     
  - unsolved : many :))) but read writeup so listed here   
     👉 

<a name="wu1"></a>     

# Baby bear     
Đây là một file bị pack bởi UPX nhưng đã bị sửa :vv   😅😅😅 Nhưng magic là vẫn đọc được đầy đủ code vì nó được compile từ assembly. Vẫn có những string cùng với một số hàm cơ bản nên việc reverse mà không cần unpack là điểu khả thi.    
![](/ctf/2020/hacktm/baby_bear/hinh1.PNG)    

Hàm ```start``` :    

![](/ctf/2020/hacktm/baby_bear/hinh2.PNG)    

Hàm start bắt đầu bằng việc đọc 16 bytes từ file /dev/urandom làm giá trị khởi tạo, chuyển nó về dạng bit theo kiểu 'a' -> '10000110' rồi in hình con gấu.   Sau đó, là đến đoạn mã hóa string :    

![](/ctf/2020/hacktm/baby_bear/hinh3.PNG)    

Do đang bị pack nên trông không ra hàm nhưng ta có thể hiểu được hàm mã hóa này có hai tham số truyền vào là độ dài đoạn mã hóa đầu ra là 46 và địa chỉ lưu giữ string là ```esi = 0x600780```.   
Trong mỗi lần lặp, nó sẽ tăng esi lên từ 1 - 3 đơn vị và cho ra một giá trị output, in ra màn hình bằng hàm ```sub_4000B0```. Output đầu ra có thể lấy từ chuỗi truyền vào hoặc không, do đó input mà ta tìm được có thể không giống với input ban đầu.    
Ban đầu , mình dùng unicorn để dựng lại hàm mã hóa này, cho một input đầu vào và có được output đầu ra. Việc thiết lập unicorn theo các bước không quá phức tạp : [basic setup](https://www.notion.so/Basic-Setup-179a2615e2a7472d8083423f05126bf8) và [execute binary function](https://www.notion.so/Execute-Binary-Function-08884ed07d9b44519c44963fb641b35e) . 😁😁😁Sau khi chơi với input ngẫu nhiên và xem output đầu ra là gì, mình rút ra được nhận xét là cứ 2 bytes đầu thì output đầu ra giống nhau ít nhất là 8 bits, 3 bytes thì là 11 bits, .... (～o￣3￣)～ BÙm mình định brute force từ đây. Nhưng có quá nhiều trường hợp và thời gian bruteforce có thể lên tới đơn vị tiếng mà timeout của server chỉ là 30s 🙄🙄🙄 Với trình độ mới tập chơi unicorn thì mình cũng khá là gà trong việc viết script này 😥😥😥    
Sau khi đọc lại code và cố viết lại graph cách hoạt động của chương trình thì mình cũng hiểu sơ sơ nhưng nó khá là phức tạp nên mình chỉ đọc đoạn đầu. Không ngờ có team ngồi reverse hết được :))) Chương trình họ viết lại được thì trông nó như này :)))     

![](/ctf/2020/hacktm/baby_bear/hinh4.PNG)    


